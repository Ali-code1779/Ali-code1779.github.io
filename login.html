<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ” Login - Restaurant Apps</title>
  <style>
    :root {
      --main-color: #1d4ed8;
      --main-dark: #172554;
      --text-color: #1e293b;
      --bg-light: #f8fafc;
      --bg-dark: #0f172a;
      --gray: #94a3b8;
    }
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg-light);
      color: var(--text-color);
      font-size: clamp(14px, 1.2vw, 18px);
      transition: all 0.3s ease;
    }
    body.dark-mode { background: var(--bg-dark); color: white; }
    header {
      background: var(--main-color); color: white; padding: 10px 20px;
    }
    .top-bar {
      display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;
    }
    .logo { font-size: 1.2rem; font-weight: bold; }
    .controls {
      display: flex; align-items: center; gap: 10px;
    }
    .controls button {
      background: white; color: var(--main-color); padding: 6px 10px;
      border: none; border-radius: 5px; cursor: pointer; font-weight: bold;
    }
    .datetime { font-size: 0.85rem; margin-left: 15px; }
    main {
      max-width: 400px; margin: 50px auto; padding: 20px;
      background: #e2e8f0; border-radius: 10px; text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    body.dark-mode main { background: #1e293b; }
    input[type="email"], input[type="password"] {
      width: 90%; padding: 10px; margin: 10px 0;
      border: none; border-radius: 5px;
    }
    .password-wrapper { position: relative; }
    .show-password {
      display: flex; justify-content: flex-start; align-items: center;
      margin-left: 20px; font-size: 0.9em; cursor: pointer; color: var(--main-color);
    }
    button.login-btn {
      background: var(--main-color); color: white; padding: 10px 20px;
      border: none; border-radius: 5px; font-weight: bold;
      cursor: pointer; margin-top: 10px;
    }
    .links { margin-top: 20px; font-size: 0.9em; }
    .links a { color: var(--main-color); text-decoration: none; margin: 0 5px; }
    footer {
      text-align: center; padding: 15px; color: var(--gray); font-size: 0.9rem;
    }
    #messageBox {
      font-weight: bold; display: none; margin-top: 15px;
      padding: 10px; border-radius: 5px;
    }
    #messageBox.success { background-color: #d1fae5; color: #065f46; border: 1px solid #10b981; }
    #messageBox.error { background-color: #fee2e2; color: #991b1b; border: 1px solid #ef4444; }
  </style>
</head>
<body>
  <header>
    <div class="top-bar">
      <div class="logo">ğŸ½ï¸ <span id="appName">Restaurant Apps</span></div>
      <div class="controls">
        <div class="datetime" id="datetime"></div>
        <button id="homeBtn">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <button id="helpBtn">â“ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
        <button id="aboutBtn">â„¹ï¸ Ù…Ù† Ù†Ø­Ù†</button>
        <button id="langBtn">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
        <button id="themeBtn">ğŸŒ™</button>
      </div>
    </div>
  </header>

  <main>
    <h2 id="loginTitle">ğŸ” Login</h2>
    <input type="email" id="email" placeholder="Email" />
    <div class="password-wrapper">
      <input type="password" id="password" placeholder="Password" />
      <label class="show-password">
        <input type="checkbox" id="togglePass" onclick="togglePassword()" />
        <span id="showText">Show password</span>
      </label>
      <div style="text-align: left; margin-left: 5%;">
        <label style="font-size: 0.9em; display: flex; align-items: center; gap: 5px;">
          <input type="checkbox" id="rememberMe" />
          <span id="rememberText">Remember me</span>
        </label>
      </div>
    </div>
    <button class="login-btn" onclick="login()" id="loginBtn">Login</button>
    <div id="messageBox"></div>
    <div class="links">
      <a href="mailto:alimahfouz78@gmail.com" id="noAccount">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a> |
      <a href="https://wa.me/966507149577" id="forgotPassword">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</a>
    </div>
  </main>

  <footer>
    &copy; 2025 ğŸ½ï¸ <span id="appNameFooter">Restaurant Qualification Apps</span>. All rights reserved.
  </footer>

  <script>
    function xorEncrypt(text, key = "secret") {
      return btoa([...text].map((c, i) =>
        String.fromCharCode(c.charCodeAt(0) ^ key.charCodeAt(i % key.length))
      ).join(""));
    }

    function xorDecrypt(encoded, key = "secret") {
      const text = atob(encoded);
      return [...text].map((c, i) =>
        String.fromCharCode(c.charCodeAt(0) ^ key.charCodeAt(i % key.length))
      ).join("");
    }

    function togglePassword() {
      const pwd = document.getElementById("password");
      pwd.type = pwd.type === "password" ? "text" : "password";
    }

    let currentLang = localStorage.getItem("lang") || "en";

    function showMessage(message, type = "error") {
      const box = document.getElementById("messageBox");
      box.innerText = message;
      box.className = type === "success" ? "success" : "error";
      box.style.display = "block";
    }

    function login() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      const remember = document.getElementById("rememberMe").checked;

      if (!email || !password) {
        showMessage(currentLang === "ar" ? "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" : "Please enter email and password");
        return;
      }

      if (remember) {
        localStorage.setItem("rememberedEmail", email);
        localStorage.setItem("rememberedPassword", xorEncrypt(password));
      } else {
        localStorage.removeItem("rememberedEmail");
        localStorage.removeItem("rememberedPassword");
      }

      const GAS_URL = 'https://script.google.com/macros/s/AKfycbzZiNu7E3n3OMJLCjllvK9fCQ9UoF7-pBQI9EeoSsHDx_zoPNmXekD497M6SEeEMxpw/exec';

      fetch(`${GAS_URL}?method=login&email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`)
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            localStorage.setItem("user", JSON.stringify(data.user));
            const role = (data.user.role || "").toLowerCase();
            if (role === "admin") {
              window.location.href = "admin_dashboard.html";
            } else if (role === "user") {
              window.location.href = "user_page.html";
            } else {
              showMessage(currentLang === "ar" ? "ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©" : "Unknown user role");
            }
          } else {
            showMessage(currentLang === "ar" ? data.message || "ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„" : data.message || "Login failed");
          }
        })
        .catch(() => {
          showMessage(currentLang === "ar" ? "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…" : "Failed to connect to server");
        });
    }

    function applyLanguage(lang) {
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === "ar" ? "rtl" : "ltr";

      document.getElementById("loginTitle").textContent = lang === "ar" ? "ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„" : "ğŸ” Login";
      document.getElementById("email").placeholder = lang === "ar" ? "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" : "Email";
      document.getElementById("password").placeholder = lang === "ar" ? "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" : "Password";
      document.getElementById("showText").textContent = lang === "ar" ? "Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" : "Show password";
      document.getElementById("rememberText").textContent = lang === "ar" ? "ØªØ°ÙƒØ±Ù†ÙŠ" : "Remember me";
      document.getElementById("loginBtn").textContent = lang === "ar" ? "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„" : "Login";
      document.getElementById("noAccount").textContent = lang === "ar" ? "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§" : "Don't have an account? Contact us";
      document.getElementById("forgotPassword").textContent = lang === "ar" ? "Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ" : "Forgot password?";
      document.getElementById("homeBtn").textContent = lang === "ar" ? "ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" : "ğŸ  Home";
      document.getElementById("helpBtn").textContent = lang === "ar" ? "â“ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©" : "â“ Help";
      document.getElementById("aboutBtn").textContent = lang === "ar" ? "â„¹ï¸ Ù…Ù† Ù†Ø­Ù†" : "â„¹ï¸ About";
      document.getElementById("langBtn").textContent = lang === "ar" ? "English" : "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©";
    }

    function updateTime() {
      const now = new Date();
      const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
      document.getElementById("datetime").textContent = now.toLocaleString(currentLang === 'ar' ? 'ar-EG' : 'en-US', options);
    }

    document.getElementById("langBtn").addEventListener("click", () => {
      currentLang = currentLang === "en" ? "ar" : "en";
      localStorage.setItem("lang", currentLang);
      applyLanguage(currentLang);
    });

    document.getElementById("themeBtn").addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
      localStorage.setItem("theme", document.body.classList.contains("dark-mode") ? "dark" : "light");
    });

    document.getElementById("homeBtn").addEventListener("click", () => {
      window.location.href = "index.html";
    });

    if (localStorage.getItem("theme") === "dark") {
      document.body.classList.add("dark-mode");
    }

    const savedEmail = localStorage.getItem("rememberedEmail");
    const savedPassword = localStorage.getItem("rememberedPassword");

    if (savedEmail) {
      document.getElementById("email").value = savedEmail;
      document.getElementById("rememberMe").checked = true;
    }
    if (savedPassword) {
      document.getElementById("password").value = xorDecrypt(savedPassword);
    }

    document.addEventListener("DOMContentLoaded", () => {
      applyLanguage(currentLang);
      updateTime();
      setInterval(updateTime, 60000);
    });
  </script>
</body>
</html>
